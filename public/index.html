<!DOCTYPE html>
<html ng-app="CrawlingSpecter">
	<head>
		<title>Crawling Specter</title>

		<link href="index.css" rel="stylesheet" type="text/css"></link>
		<link rel="icon" type="image/png" href="imgs/favicon.png"></link>

		<script src="js/jquery/jquery.min.js" type="text/javascript"></script>
		<script src="js/angularjs/angular.min.js" type="text/javascript"></script>
		<script src="controllers.js" type="text/javascript"></script>

        <script src="https://cdn.socket.io/socket.io-1.0.4.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        <script>var socket = io.connect(window.location.hostname + ":8001");</script>
        <script type="text/javascript">
            socket.on("uiUpdate", function (update){ 
                if (  update.count && ( !Number($("#countQueue").text()) || update.count > Number($("#countQueue").text()) )  )
                    $("#countQueue").text(update.count);

                if (update.status) 
                    $("#status").text(update.status);

                if (update.deadlink){
                    $("#deadlinks").append("<p style='color: red'>" + update.deadlink + "</p>");
                    $("#deadlinkcount").text( $("#deadlinks > p").length() )
                }

                    
                $("#log").append("<p style='color:" + update.color + "'>" + update.log + "</p>");
                $("#log").scrollTop(document.getElementById("log").scrollHeight)
            })

            function updateParameters(type){
                if (type || window.confirm("Starting a new crawl will purge all previous results.\n Continue?")){
                    socket.emit("paramUpdate", {
                        url: $("#url").val(), 
                        numbots: $("#numberWorkers").val(),
                        type: type,
                        numWorkers: $("#numberWorkers").val(),
                        linkaccept: $("#linkAccept").val()
                    })
                }
            }
        </script>
		
        <meta name="apple-mobile-web-app-capable" content="yes"></meta>
		<meta name="apple-mobile-web-app-status-bar-style" content="black"></meta>
		<meta name = "viewport" content ="user-scalable=no, width=640, initial-scale=.5"></meta>
		<link rel="apple-touch-startup-image" href="imgs/iphoneicon.png"></link>
	</head>

	<body style="margin: 0px;">
		<section ng-controller="crawlerController">
			<main style="height: 100vh; width: 100vw;">
				<p>
                    <p>
                        Url: <input type="url" id="url"></input>
                        <input type="button" id="startcrawl" value="Start Crawl" onclick="updateParameters()"></input>
                        <input type="button" id="stopcrawl" value="Stop Crawl" onclick="updateParameters('stop')"></input>
                        <input type="button" id="resumecrawl" value="Resume Crawl" onclick="updateParameters('resume')"></input>
                    </p>
                    <p>Number Workers: <input type="number" id="numberWorkers" value=1></input></p>
                    <p><div id="log"></div></p>
                    <div>Links queued: <p id="countQueue">hi</p></div>
                    <div>Status: <p id="status"></p></div>
                    <p><div id="deadlinks">Dead links:</div></p>
                    <p><div>Dead links (since page load): <p id="deadLinkCount">0</p></div></p>
                    <p>Custom Link Filter<textarea id="linkAccept" rows=20 style="display: block; width: 98vw;"></textarea></p>
				</p>
            </main>
		</section>
	</body>

</html>
